<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<title>—</title>
	<link rel="shortcut icon" href="fonts/favicon.ico" />
	<link rel="stylesheet" href="css/materialize.min.css">
	<link href="css/material-icons.css" rel="stylesheet">
	<link rel="stylesheet/less" href="css/style.less">
	<script src="js/less.min.js"></script>
	<!-- <script type="text/javascript">less.watch();</script> -->
</head>
<body>

<div class="wrapperBox active">
	<div class="inner">
		<div class="preloader-wrapper loader-wrapper active">
			<div class="spinner-layer spinner-blue">
		    <div class="circle-clipper left">
		      <div class="circle"></div>
		    </div><div class="gap-patch">
		      <div class="circle"></div>
		    </div><div class="circle-clipper right">
		      <div class="circle"></div>
		    </div>
		  </div>
		  <div class="spinner-layer spinner-red">
		    <div class="circle-clipper left">
		      <div class="circle"></div>
		    </div><div class="gap-patch">
		      <div class="circle"></div>
		    </div><div class="circle-clipper right">
		      <div class="circle"></div>
		    </div>
		  </div>
		  <div class="spinner-layer spinner-yellow">
		    <div class="circle-clipper left">
		      <div class="circle"></div>
		    </div><div class="gap-patch">
		      <div class="circle"></div>
		    </div><div class="circle-clipper right">
		      <div class="circle"></div>
		    </div>
		  </div>
		  <div class="spinner-layer spinner-green">
		    <div class="circle-clipper left">
		      <div class="circle"></div>
		    </div><div class="gap-patch">
		      <div class="circle"></div>
		    </div><div class="circle-clipper right">
		      <div class="circle"></div>
		    </div>
		  </div>
		</div>
	</div>
</div>

<div class="navbar-fixed">
  <nav>
    <div class="nav-wrapper">
      <a href="https://xn--xkrt4xga.xn--6qq986b3xl/" class="btn-floating btn-large waves-effect waves-dark left-operate">
      	<i class="material-icons">arrow_back</i>
      </a>
      <a href="javascript:;" class="brand-logo"><i class="material-icons">assignment</i></a>
      <!-- <button type="button" class="btn-floating btn-large waves-effect waves-dark right-operate">
      	<i class="material-icons">done</i>
      </button> -->
    </div>
  </nav>
</div>

<div class="timeline">

	<!-- <div class="timeitem">
		<a href="#">
			<div class="left">
				<div class="ico"></div>
				<div class="time">123</div>
			</div>
			<div class="right">
				<div class="info">阿斯达阿斯达</div>

				<div class="fileInputBox">
					<div class="container">
						<div class="row" id="filetainer">
				      <div class="col s3">
				      	<div class="item">
				      		<img src="images/user.jpg">
				      	</div>
				      </div>
				      <div class="col s3">
				      	<div class="item">
				      		<img src="images/user.jpg">
				      	</div>
				      </div>
				      <div class="col s3">
				      	<div class="item">
				      		<img src="images/user.jpg">
				      	</div>
				      </div>
				    </div>
					</div>
				</div>

			</div>
		</a>
	</div> -->

</div>

<div class="preloader-wrapper more-loader small active">
	<div class="spinner-layer spinner-blue">
    <div class="circle-clipper left">
      <div class="circle"></div>
    </div><div class="gap-patch">
      <div class="circle"></div>
    </div><div class="circle-clipper right">
      <div class="circle"></div>
    </div>
  </div>
  <div class="spinner-layer spinner-red">
    <div class="circle-clipper left">
      <div class="circle"></div>
    </div><div class="gap-patch">
      <div class="circle"></div>
    </div><div class="circle-clipper right">
      <div class="circle"></div>
    </div>
  </div>
  <div class="spinner-layer spinner-yellow">
    <div class="circle-clipper left">
      <div class="circle"></div>
    </div><div class="gap-patch">
      <div class="circle"></div>
    </div><div class="circle-clipper right">
      <div class="circle"></div>
    </div>
  </div>
  <div class="spinner-layer spinner-green">
    <div class="circle-clipper left">
      <div class="circle"></div>
    </div><div class="gap-patch">
      <div class="circle"></div>
    </div><div class="circle-clipper right">
      <div class="circle"></div>
    </div>
  </div>
</div>

<div class="fixed-action-btn">
	<a class="btn-floating btn-large waves-effect waves-dark red" href="write.html"><i class="material-icons">create</i></a>
</div>

<script src="js/jquery.min.js"></script>
<script src="js/materialize.min.js"></script>
<script src="js/main.js"></script>
<script>
	var page = 1;
	var pagesize = 10;

	var lock = true;	//防止重复提交定义锁

	$.ajax({
	  url: 'api/list.php',
	  type: 'get',
	  data: {
	  	page: page,
	  	pagesize: pagesize
	  },
	  dataType: 'json',
	  success: function(res){
	    console.log(res);
	    $(".loader-wrapper").delay(300).fadeOut();
			$(".wrapperBox").delay(600).fadeOut("slow");
	    for(var i=0;i<res.data.length;i++){
	      $('.timeline').append(
		      '<div class="timeitem">' +
						'<a href="info.html?id='+ res.data[i].id +'">' +
							'<div class="left">' +
								'<div class="ico"></div>' +
								'<div class="time">'+ res.data[i].date +'</div>' +
							'</div>' +
							'<div class="right">' +
								'<div class="info">'+ res.data[i].info +'</div>' +
							'</div>' +
						'</a>' +
					'</div>'
				);
	    }
	  }
	})

	$(window).scroll(function(){
　　var scrollTop = document.documentElement.scrollTop||document.body.scrollTop;
　　var windowHeight = document.documentElement.clientHeight || document.body.clientHeight;
　　var scrollHeight = document.documentElement.scrollHeight||document.body.scrollHeight;
　　if(scrollTop / (scrollHeight - windowHeight) >= 0.6){
			if (!lock) {
				return false;
			}
			lock = false;
			$.ajax({
			  url: 'api/list.php',
			  type: 'get',
			  data: {
			  	page: page+1,
			  	pagesize: pagesize
			  },
			  dataType: 'json',
			  beforeSend: function(){
			  	// 底部加载
			  	// $(".more-loader").addClass('show');
			  },
			  success: function(res){
			    page += 1;
			    lock = true;
			    // $(".more-loader").removeClass('show');
			    if (res.data.length > 0) {
			    	// 还有数据就添加
			    	for(var i=0;i<res.data.length;i++){
				      $('.timeline').append(
					      '<div class="timeitem">' +
									'<a href="info.html?id='+ res.data[i].id +'">' +
										'<div class="left">' +
											'<div class="ico"></div>' +
											'<div class="time">'+ res.data[i].date +'</div>' +
										'</div>' +
										'<div class="right">' +
											'<div class="info">'+ res.data[i].info +'</div>' +
										'</div>' +
									'</a>' +
								'</div>'
							);
				    }
			    }else{
			    	// Materialize.toast('树洞给你挖空啦', 1500)
		    		$('.timeline').append(
				      '<div class="timeitem no-pdb">' +
								'<a href="javascript:;">' +
									'<div class="left">' +
										'<div class="ico"></div>' +
									'</div>' +
									'<div class="right">' +
										'<div class="info">树洞给你挖空啦</div>' +
									'</div>' +
								'</a>' +
							'</div>'
						);
			    	lock = false;
			    }
			  }
			})
　　}
	});
</script>

</body>
</html>